---
import type { ImageMetadata } from 'astro';
import Image from '~/components/common/Image.astro';
import { Icon } from 'astro-icon/components';
import { getDefaultImage, getDefaultSpeakerImage } from '~/services/events';
import type { FestivalDay } from '~/services/events';
import type { Event as FestivalEvent } from '~/types/festival';

// Interface √©tendue pour les √©v√©nements avec des propri√©t√©s suppl√©mentaires
interface ProcessedEvent extends FestivalEvent {
  imageDownloaded?: boolean;
  speakerImageDownloaded?: boolean;
}

interface Props {
  // Prend soit un objet Event complet, soit des propri√©t√©s individuelles
  event?: FestivalEvent;
  title?: string;
  description?: string;
  date?: string;
  time?: string;
  location?: string;
  speaker?: string;
  speakerImage?: string | ImageMetadata;
  image?: ImageMetadata | string;
  badge?: string;
  badgeColor?: 'purple' | 'blue';
  link?: string;
  day?: FestivalDay;
  cols?: number;
  eventType?: 'Conf√©rences' | 'Ateliers' | 'Stands';
  target?: string;
  level?: string;
  teachingType?: string;
  url?: string;
}

const { 
  event,
  title: propTitle, 
  description: propDescription, 
  date: propDate,
  time: propTime,
  location: propLocation,
  speaker: propSpeaker,
  speakerImage: propSpeakerImage,
  image: propImage,
  badge: propBadge,
  badgeColor = 'blue',
  link: propLink,
  day: propDay,
  cols = 1,
  eventType: propEventType = 'Conf√©rences',
  target: propTarget,
  level: propLevel,
  teachingType: propTeachingType,
  url: propUrl
} = Astro.props;

// V√©rifier si l'√©v√©nement a des images t√©l√©charg√©es
const processedEvent = event as ProcessedEvent | undefined;
const hasDownloadedImage = processedEvent?.imageDownloaded === true;
const hasDownloadedSpeakerImage = processedEvent?.speakerImageDownloaded === true;

// Utiliser les propri√©t√©s de l'objet Event s'il est fourni, sinon utiliser les props individuelles
const title = event?.title || propTitle || '';
const description = event?.description || propDescription || '';
const date = event?.day || propDate || '';
const time = event?.time || propTime || '';
const location = event?.location || propLocation || '';
const speaker = event?.speaker || propSpeaker || '';
const speakerImage = event?.speakerImage || propSpeakerImage;
const originalImage = event?.image || propImage;
const badge = propBadge || '';
const link = event?.url || propLink || '#';

// Normaliser le jour pour garantir la coh√©rence
let day = event?.day || propDay;
// S'assurer que le jour est une des valeurs accept√©es
if (day) {
  const dayLower = day.toString().trim().toLowerCase();
  if (dayLower.includes('vendredi')) {
    day = 'Vendredi';
  } else if (dayLower.includes('jeudi')) {
    day = 'Jeudi';
  } else if (dayLower.includes('mercredi')) {
    day = 'Mercredi';
  }
}

// Log pour d√©bogage des √©v√©nements du vendredi
if (day && day.toString().toLowerCase().includes('vendredi')) {
  console.log(`[DEBUG VENDREDI] √âv√©nement du vendredi d√©tect√©: "${title}" - jour original="${event?.day || propDay}", normalis√©="${day}"`);
}

const eventType = event?.type || propEventType;
const target = event?.target || propTarget;
const level = event?.level || propLevel;
const teachingType = event?.teachingType || propTeachingType;
const url = event?.url || propUrl;

const badgeIcons: Record<string, string> = {
  'Festival 2025': 'tabler:confetti',
  'Live Facebook': 'tabler:brand-facebook',
  'Conf√©rences': 'tabler:presentation',
  'Ateliers': 'tabler:tool',
  'Stands': 'tabler:building-store'
};

/**
 * V√©rifie si une URL d'image est probl√©matique (susceptible de causer des erreurs CORS)
 * @param url L'URL √† v√©rifier
 * @returns true si l'URL est probl√©matique, false sinon
 */
const isProblematicUrl = (url: string): boolean => {
  // Cas 1: Format CSV de NocoDB - nom_fichier.extension(url...)
  if (url.match(/\.(jpg|jpeg|png|webp|gif|svg)\(/i)) {
    console.log(`‚ö†Ô∏è URL probl√©matique (format CSV): ${url}`);
    return true;
  }
  
  // Note: Les URLs sign√©es Amazon S3 sont en fait valides √† t√©l√©charger
  // Nous ne les consid√©rons plus comme probl√©matiques
  
  // Cas 3: URL sans extension d'image valide
  const hasImageExtension = /\.(jpg|jpeg|png|webp|gif|svg)($|\?)/i.test(url);
  if (!hasImageExtension && !url.includes('X-Amz-Signature=')) {
    // Exception pour les URLs S3 sign√©es qui peuvent ne pas avoir d'extension visible
    console.log(`‚ö†Ô∏è URL probl√©matique (sans extension): ${url}`);
    return true;
  }
  
  return false;
};

/**
 * V√©rifie si une image est fournie et valide
 * @param img L'image √† v√©rifier
 * @returns true si l'image est valide, false sinon
 */
const isValidImage = (img?: ImageMetadata | string): boolean => {
  if (!img) return false;
  
  // Pour les images de type string (URLs)
  if (typeof img === 'string') {
    // Si c'est un chemin vers une image t√©l√©charg√©e dans src/assets
    if (img.startsWith('~/assets/')) {
      return true;
    }
    
    // V√©rifier si l'URL est probl√©matique
    if (isProblematicUrl(img)) {
      return false;
    }
    
    // Les URLs S3 sign√©es sont consid√©r√©es comme valides m√™me sans extension visible
    if (img.includes('X-Amz-Signature=')) {
      return true;
    }
    
    // Pour les autres URLs, v√©rifier l'extension
    const hasImageExtension = /\.(jpg|jpeg|png|webp|gif|svg)($|\?)/i.test(img);
    return hasImageExtension;
  }
  
  // Pour les images de type ImageMetadata (import√©es)
  return true;
};

// Importer dynamiquement l'image si elle a √©t√© t√©l√©charg√©e
let importedImage: ImageMetadata | null = null;
let importedSpeakerImage: ImageMetadata | null = null;

if (hasDownloadedImage && typeof originalImage === 'string' && originalImage.startsWith('~/assets/')) {
  try {
    // Utiliser un import dynamique pour charger l'image
    // Note: Cette partie sera ex√©cut√©e c√¥t√© serveur lors du build
    // Correction du chemin d'importation pour √©viter les erreurs de chemin
    const importPath = originalImage.replace('~/', '../../');
    console.log(`üîç Tentative d'import de l'image: ${importPath} (type: ${eventType}, titre: ${title}, ID: ${event?.id || 'inconnu'})`);
    
    try {
      // Essayer d'abord avec le chemin original
      const imageModule = await import(importPath);
      importedImage = imageModule.default;
      console.log(`‚úÖ Image import√©e avec succ√®s: ${originalImage} (type: ${eventType}, ID: ${event?.id || 'inconnu'})`);
    } catch (initialError) {
      // Si l'importation √©choue, essayer avec un chemin normalis√©
      // (√©liminer la redondance dans le nom du fichier, ex: atelier-atelier-XX -> atelier-XX)
      console.log(`‚ö†Ô∏è √âchec de l'import avec le chemin original. Tentative avec chemin normalis√©...`);
      
      // Extraire les composants du chemin
      const pathParts = importPath.split('/');
      const filename = pathParts.pop() || '';
      const directory = pathParts.join('/');
      
      // Normaliser le nom de fichier pour √©liminer la redondance
      // Ex: conference-conference-34.webp -> conference-34.webp
      const eventTypePrefix = eventType.toLowerCase().replace(/s$/, ''); // Enlever le 's' final (Conf√©rences -> conference)
      const normalizedFilename = filename.replace(`${eventTypePrefix}-${eventTypePrefix}-`, `${eventTypePrefix}-`);
      
      const normalizedPath = `${directory}/${normalizedFilename}`;
      console.log(`üîç Tentative avec chemin normalis√©: ${normalizedPath}`);
      
      try {
        const normalizedModule = await import(normalizedPath);
        importedImage = normalizedModule.default;
        console.log(`‚úÖ Image import√©e avec succ√®s (chemin normalis√©): ${normalizedPath}`);
      } catch (normalizedError) {
        // Si les deux √©chouent, consigner l'erreur
        console.error(`‚ùå √âchec de l'import avec les deux chemins:`, { 
          original: importPath, 
          normalized: normalizedPath 
        });
        // Ne pas relancer l'erreur pour √©viter de bloquer le rendu
        console.error(`   Erreur: ${initialError.message}`);
      }
    }
  } catch (error) {
    console.error(`‚ùå Erreur lors de l'import de l'image: ${originalImage}`, error);
    console.error(`   Titre: ${title}, Type: ${eventType}, ID: ${event?.id || 'inconnu'}`);
    importedImage = null;
  }
}

if (hasDownloadedSpeakerImage && typeof speakerImage === 'string' && speakerImage.startsWith('~/assets/')) {
  try {
    // Utiliser un import dynamique pour charger l'image du conf√©rencier
    const importPath = speakerImage.replace('~/', '../../');
    
    try {
      // Essayer d'abord avec le chemin original
      const imageModule = await import(importPath);
      importedSpeakerImage = imageModule.default;
      console.log(`‚úÖ Image de conf√©rencier import√©e avec succ√®s: ${speakerImage}`);
    } catch (initialError) {
      // Si l'importation √©choue, essayer avec un chemin normalis√©
      console.log(`‚ö†Ô∏è √âchec de l'import de l'image de conf√©rencier avec le chemin original. Tentative avec chemin normalis√©...`);
      
      // Extraire les composants du chemin
      const pathParts = importPath.split('/');
      const filename = pathParts.pop() || '';
      const directory = pathParts.join('/');
      
      // Normaliser le nom de fichier
      const eventTypePrefix = eventType.toLowerCase().replace(/s$/, '');
      const normalizedFilename = filename.replace(`${eventTypePrefix}-${eventTypePrefix}-`, `${eventTypePrefix}-`);
      
      const normalizedPath = `${directory}/${normalizedFilename}`;
      console.log(`üîç Tentative avec chemin normalis√© pour l'image de conf√©rencier: ${normalizedPath}`);
      
      try {
        const normalizedModule = await import(normalizedPath);
        importedSpeakerImage = normalizedModule.default;
        console.log(`‚úÖ Image de conf√©rencier import√©e avec succ√®s (chemin normalis√©): ${normalizedPath}`);
      } catch (normalizedError) {
        console.error(`‚ùå √âchec de l'import de l'image de conf√©rencier avec les deux chemins:`, { 
          original: importPath, 
          normalized: normalizedPath 
        });
        // Ne pas relancer l'erreur pour √©viter de bloquer le rendu
        console.error(`   Erreur: ${initialError.message}`);
      }
    }
  } catch (error) {
    console.error(`‚ùå Erreur lors de l'import de l'image de conf√©rencier: ${speakerImage}`, error);
    importedSpeakerImage = null;
  }
}

/**
 * Obtient l'image √† utiliser pour l'√©v√©nement
 * Utilise des fonds de couleur avec ic√¥nes pour chaque type d'√©v√©nement
 * @returns L'image √† utiliser
 */
const getImage = () => {
  // Configuration des couleurs et ic√¥nes par type d'√©v√©nement
  const eventBackgrounds = {
    'Conf√©rences': {
      color: '#fff5f2', // Fond orang√© tr√®s clair
      icon: 'tabler:presentation',
      iconColor: '#e4451e' // Rouge/orange du th√®me
    },
    'Ateliers': {
      color: '#f0f7ff', // Fond bleu tr√®s clair
      icon: 'tabler:tool',
      iconColor: '#2563eb' // Bleu
    },
    'Stands': {
      color: '#f0fff4', // Fond vert tr√®s clair
      icon: 'tabler:building-store',
      iconColor: '#16a34a' // Vert
    }
  };

  // Si nous avons une image import√©e, l'utiliser
  if (importedImage) {
    return {
      type: 'imported',
      src: importedImage,
      backgroundColor: eventBackgrounds[eventType]?.color || '#f8f9fa'
    };
  }

  // V√©rifier si l'image originale est probl√©matique ou non valide
  if (!originalImage || isProblematicUrl(originalImage)) {
    // S√©lectionner le fond et l'ic√¥ne bas√©s sur le type d'√©v√©nement
    const background = eventBackgrounds[eventType] || eventBackgrounds['Conf√©rences'];
    
    return {
      type: 'background',
      src: '', // Pas d'image source, nous utilisons un fond de couleur
      backgroundColor: background.color,
      icon: background.icon,
      iconColor: background.iconColor
    };
  }

  // Si l'image originale est valide, l'utiliser
  return {
    type: 'custom',
    src: originalImage,
    backgroundColor: eventBackgrounds[eventType]?.color || '#f8f9fa' // Fond par d√©faut pour les images r√©elles
  };
};

/**
 * Obtient l'image du conf√©rencier
 * @returns L'image du conf√©rencier √† utiliser
 */
const getSpeakerImg = () => {
  // Si nous avons une image de conf√©rencier import√©e, l'utiliser
  if (importedSpeakerImage) {
    return importedSpeakerImage;
  }

  // Image placeholder d'avatar g√©n√©rique pour les conf√©renciers
  const speakerPlaceholder = 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f464.png';
  
  if (speakerImage && isValidImage(speakerImage)) {
    return speakerImage;
  }
  
  return speakerPlaceholder;
};

// Obtenir l'image √† utiliser
const image = getImage();
const speakerImg = getSpeakerImg();

// Configuration des types d'√©v√©nements avec ic√¥nes et couleurs
const eventTypeConfig: Record<string, {
  icon: string;
  color: string;
  bgClass: string;
  textClass: string;
}> = {
  'Festival 2025': {
    icon: 'tabler:confetti',
    color: 'var(--content-premium)',
    bgClass: 'bg-[color-mix(in_srgb,var(--content-premium)_30%,white)]',
    textClass: 'text-[var(--content-premium)]'
  },
  'Live Facebook': {
    icon: 'tabler:broadcast',
    color: 'var(--content-live)',
    bgClass: 'bg-[color-mix(in_srgb,var(--content-live)_30%,white)]',
    textClass: 'text-[var(--content-live)]'
  },
  'Conf√©rences': {
    icon: 'tabler:presentation',
    color: 'var(--content-actualite)',
    bgClass: 'bg-[color-mix(in_srgb,var(--content-actualite)_30%,white)]',
    textClass: 'text-[var(--content-actualite)]'
  },
  'Ateliers': {
    icon: 'tabler:tool',
    color: 'var(--content-podcast)',
    bgClass: 'bg-[color-mix(in_srgb,var(--content-podcast)_30%,white)]',
    textClass: 'text-[var(--content-podcast)]'
  },
  'Stands': {
    icon: 'tabler:building-store',
    color: 'var(--content-tv)',
    bgClass: 'bg-[color-mix(in_srgb,var(--content-tv)_30%,white)]',
    textClass: 'text-[var(--content-tv)]'
  }
};

// Obtenir la configuration pour ce type d'√©v√©nement ou badge
const config = eventTypeConfig[eventType] || eventTypeConfig[badge] || {
  icon: 'tabler:calendar-event',
  color: 'var(--content-actualite)',
  bgClass: 'bg-[color-mix(in_srgb,var(--content-actualite)_30%,white)]',
  textClass: 'text-[var(--content-actualite)]'
};

// Cr√©er un objet de d√©bogage pour l'attribut data-debug
const debugInfo = {
  title,
  originalImageType: typeof originalImage,
  originalImageValue: typeof originalImage === 'string' ? originalImage : 'ImageMetadata',
  imageValid: isValidImage(originalImage),
  imageType: image.type,
  badge,
  eventType,
  icon: config.icon
};
---

<!-- Version compl√®te pour l'affichage en liste dans DayFilter -->
<div 
  class="event-card group bg-white rounded-xl border border-gray-100 overflow-hidden hover:shadow-lg transition-all duration-300"
  data-type={eventType}
  data-day={day}
  data-time={time}
>
  <div class="md:flex h-full">
    <!-- Image √† gauche (sur desktop) ou en haut (sur mobile) -->
    <div class="md:w-1/3 relative overflow-hidden md:rounded-l-xl p-6" style={`background-color: ${image.backgroundColor}`}>
      <div class="h-56 md:h-full flex items-center justify-center">
        {image.type === 'imported' ? (
          <Image
            src={image.src}
            alt={title}
            class="max-w-full max-h-full object-contain"
            widths={[300, 600]}
            sizes="(max-width: 640px) 300px, 600px"
            aspectRatio="auto"
            loading="lazy"
            decoding="async"
            format="webp"
            fetchpriority="low"
          />
        ) : image.type === 'custom' ? (
          <Image
            src={image.src}
            alt={title}
            class="max-w-full max-h-full object-contain"
            widths={[300, 600]}
            sizes="(max-width: 640px) 300px, 600px"
            aspectRatio="auto"
            loading="lazy"
            decoding="async"
            format="webp"
            fetchpriority="low"
          />
        ) : (
          <div class="w-full h-full flex items-center justify-center">
            <Icon name={image.icon} class="w-24 h-24" style={`color: ${image.iconColor}`} />
          </div>
        )}
      </div>
      <!-- Badge du type d'√©v√©nement (visible uniquement sur mobile) -->
      <div class="absolute top-3 right-3 inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium backdrop-blur-sm shadow-sm"
           style={`
             background-color: ${eventType === 'Conf√©rences' ? 'rgba(228, 69, 30, 0.15)' : 
                                eventType === 'Ateliers' ? 'rgba(37, 99, 235, 0.15)' : 
                                'rgba(22, 163, 74, 0.15)'};
             color: ${eventType === 'Conf√©rences' ? '#e4451e' : 
                     eventType === 'Ateliers' ? '#2563eb' : 
                     '#16a34a'};
             border: 1px solid ${eventType === 'Conf√©rences' ? 'rgba(228, 69, 30, 0.3)' : 
                                eventType === 'Ateliers' ? 'rgba(37, 99, 235, 0.3)' : 
                                'rgba(22, 163, 74, 0.3)'};
           `}
      >
        <Icon name={config.icon} class="w-3.5 h-3.5" />
        {eventType}
      </div>
    </div>

    <!-- Contenu √† droite (sur desktop) ou en bas (sur mobile) -->
    <div class="md:w-2/3 p-4 md:p-6 flex flex-col">
      <div class="flex-grow">
        <!-- En-t√™te avec heure, lieu et expert - Version desktop -->
        <div class="hidden md:flex flex-wrap items-center gap-2 md:gap-4 text-sm text-gray-500 mb-2 md:mb-3">
          {day && (
            <div class="flex items-center">
              <Icon name="tabler:calendar" class="w-4 h-4 mr-1" />
              <span>{day}</span>
            </div>
          )}
          {time && (
            <div class="flex items-center">
              <Icon name="tabler:clock" class="w-4 h-4 mr-1" />
              <span>{time}</span>
            </div>
          )}
          {location && (
            <div class="flex items-center">
              <Icon name="tabler:map-pin" class="w-4 h-4 mr-1" />
              <span>{location}</span>
            </div>
          )}
          {speaker && (
            <div class="flex items-center">
              <Icon name="tabler:user" class="w-4 h-4 mr-1" />
              <span class="font-medium text-gray-500">{speaker}</span>
            </div>
          )}
        </div>

        <!-- En-t√™te simplifi√© pour mobile -->
        <div class="flex md:hidden flex-wrap items-center gap-2 text-sm text-gray-500 mb-2">
          {day && (
            <div class="flex items-center">
              <Icon name="tabler:calendar" class="w-4 h-4 mr-1" />
              <span>{day}</span>
            </div>
          )}
          {time && (
            <div class="flex items-center">
              <Icon name="tabler:clock" class="w-4 h-4 mr-1" />
              <span>{time}</span>
            </div>
          )}
        </div>

        <!-- Photo du conf√©rencier (uniquement pour les conf√©rences) -->
        {eventType === 'Conf√©rences' && speaker && (
          <div class="mb-3 hidden md:flex items-center">
            <div class="w-20 h-20 rounded-full overflow-hidden mr-3 flex-shrink-0 bg-white border border-gray-200 p-0">
              <Image
                src={speakerImg}
                alt={speaker || "Conf√©rencier"}
                class="w-full h-full object-cover"
                width={160}
                height={160}
                loading="lazy"
                decoding="async"
                format="webp"
              />
            </div>
            <div class="text-sm text-gray-600">
              <p class="font-medium text-[#e4451e]">{speaker}</p>
              <p class="italic">Conf√©rencier</p>
            </div>
          </div>
        )}

        <!-- Titre -->
        <h3 class="text-xl md:text-2xl font-bold text-sky-900 group-hover:text-[#e4451e] transition-colors mb-2 md:mb-3">
          {title}
        </h3>

        <!-- Description avec accord√©on pour les textes longs - Version desktop -->
        <div class="description-container relative hidden md:block">
          <p class="text-gray-600 mb-2 md:mb-4 description-text line-clamp-4 pr-16">{description}</p>
          {description && description.length > 280 && (
            <button 
              class="text-[#e4451e] text-sm font-medium flex items-center gap-1.5 description-toggle hover:bg-[#e4451e]/10 transition-all duration-300 absolute bottom-0 right-0 px-2 py-1 rounded-md"
              aria-expanded="false"
            >
              <span class="show-more inline-flex items-center">
                <span></span>
                <Icon name="tabler:chevron-down" class="w-4 h-4 ml-1 description-icon transition-transform duration-300" />
              </span>
              <span class="show-less hidden inline-flex items-center">
                <span>Voir moins</span>
                <Icon name="tabler:chevron-up" class="w-4 h-4 ml-1 transition-transform duration-300" />
              </span>
            </button>
          )}
        </div>

        <!-- Informations suppl√©mentaires - Version desktop -->
        <div class="hidden md:grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2 mb-3">
          {target && (
            <div class="flex items-start text-sm text-gray-600">
              <Icon name="tabler:users" class="w-4 h-4 mr-2 text-[#e4451e] flex-shrink-0 mt-0.5" />
              <span><span class="font-medium">Public:</span> {target}</span>
            </div>
          )}
          {level && (
            <div class="flex items-start text-sm text-gray-600">
              <Icon name="tabler:school" class="w-4 h-4 mr-2 text-[#e4451e] flex-shrink-0 mt-0.5" />
              <span><span class="font-medium">Niveau:</span> {level}</span>
            </div>
          )}
          {teachingType && (
            <div class="flex items-start text-sm text-gray-600">
              <Icon name="tabler:book" class="w-4 h-4 mr-2 text-[#e4451e] flex-shrink-0 mt-0.5" />
              <span><span class="font-medium">Type:</span> {teachingType}</span>
            </div>
          )}
        </div>

        <!-- Bouton "Voir les d√©tails" pour mobile -->
        <div class="md:hidden mt-4">
          <button 
            class="details-toggle w-full py-3 px-4 text-base font-medium text-[#e4451e] border border-[#e4451e]/20 rounded-lg flex items-center justify-center gap-2 hover:bg-[#e4451e]/5 transition-all duration-300"
            aria-expanded="false"
          >
            <span class="show-details">Voir les d√©tails</span>
            <span class="hide-details hidden">Masquer les d√©tails</span>
            <Icon name="tabler:chevron-down" class="w-5 h-5 details-icon transition-transform duration-300" />
          </button>
        </div>

        <!-- D√©tails suppl√©mentaires pour mobile (masqu√©s par d√©faut) -->
        <div class="mobile-details hidden md:hidden mt-4 space-y-4 border-t border-gray-100 pt-4">
          <!-- Description compl√®te pour mobile -->
          <div class="text-gray-600">
            <p class="text-base">{description}</p>
          </div>
          
          <!-- Informations sur le lieu et l'intervenant -->
          <div class="flex flex-col gap-3 text-base">
            {location && (
              <div class="flex items-start gap-2">
                <Icon name="tabler:map-pin" class="w-5 h-5 text-[#e4451e] flex-shrink-0 mt-0.5" />
                <span class="text-gray-600">{location}</span>
              </div>
            )}
            {speaker && (
              <div class="flex items-start gap-2">
                <Icon name="tabler:user" class="w-5 h-5 text-[#e4451e] flex-shrink-0 mt-0.5" />
                <span class="text-gray-600 font-medium">{speaker}</span>
              </div>
            )}
          </div>

          <!-- Photo du conf√©rencier pour mobile -->
          {eventType === 'Conf√©rences' && speaker && (
            <div class="flex items-center mt-4">
              <div class="w-16 h-16 rounded-full overflow-hidden mr-3 flex-shrink-0 bg-white border border-gray-200 p-0">
                <Image
                  src={speakerImg}
                  alt={speaker || "Conf√©rencier"}
                  class="w-full h-full object-cover"
                  width={128}
                  height={128}
                  loading="lazy"
                  decoding="async"
                  format="webp"
                />
              </div>
              <div class="text-sm text-gray-600">
                <p class="font-medium text-[#e4451e]">{speaker}</p>
                <p class="italic">Conf√©rencier</p>
              </div>
            </div>
          )}

          <!-- Informations suppl√©mentaires pour mobile -->
          <div class="grid grid-cols-1 gap-3">
            {target && (
              <div class="flex items-start text-base text-gray-600">
                <Icon name="tabler:users" class="w-5 h-5 mr-2 text-[#e4451e] flex-shrink-0 mt-0.5" />
                <span><span class="font-medium">Public:</span> {target}</span>
              </div>
            )}
            {level && (
              <div class="flex items-start text-base text-gray-600">
                <Icon name="tabler:school" class="w-5 h-5 mr-2 text-[#e4451e] flex-shrink-0 mt-0.5" />
                <span><span class="font-medium">Niveau:</span> {level}</span>
              </div>
            )}
            {teachingType && (
              <div class="flex items-start text-base text-gray-600">
                <Icon name="tabler:book" class="w-5 h-5 mr-2 text-[#e4451e] flex-shrink-0 mt-0.5" />
                <span><span class="font-medium">Type:</span> {teachingType}</span>
              </div>
            )}
          </div>
          
          <!-- Lien vers le site web dans les d√©tails pour mobile -->
          {url && (
            <div class="flex items-center mt-4 pt-2 border-t border-gray-100">
              <a 
                href={url} 
                target="_blank" 
                rel="noopener noreferrer" 
                class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium text-[#e4451e] hover:bg-[#e4451e]/10 transition-colors w-full justify-center border border-[#e4451e]/20"
              >
                <Icon name="tabler:external-link" class="w-4 h-4" />
                Visiter le site web
              </a>
            </div>
          )}
        </div>
      </div>

      <div class="mt-auto flex flex-wrap items-center justify-between gap-2">
       
        <!-- Lien vers le site web supprim√© du bas de la carte -->
      </div>
    </div>
  </div>
</div> 

<script is:inline>
document.addEventListener('DOMContentLoaded', () => {
  const descriptionContainers = document.querySelectorAll('.description-container');
  
  descriptionContainers.forEach(container => {
    const descriptionText = container.querySelector('.description-text');
    const toggleButton = container.querySelector('.description-toggle');
    const showMoreSpan = container.querySelector('.show-more');
    const showLessSpan = container.querySelector('.show-less');
    const descriptionIcon = container.querySelector('.description-icon');
    
    if (toggleButton && descriptionText) {
      toggleButton.addEventListener('click', () => {
        const isExpanded = toggleButton.getAttribute('aria-expanded') === 'true';
        
        toggleButton.setAttribute('aria-expanded', !isExpanded);
        descriptionText.classList.toggle('line-clamp-4');
        showMoreSpan.classList.toggle('hidden');
        showLessSpan.classList.toggle('hidden');
        descriptionIcon.classList.toggle('rotate-180');
      });
    }
  });
});
</script>